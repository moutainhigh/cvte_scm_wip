<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cvte.scm.wip.infrastructure.ckd.mapper.WipMcTaskLineMapper">
    <resultMap id="BaseResultMap" type="com.cvte.scm.wip.infrastructure.ckd.mapper.dataobject.WipMcTaskLineDO">
        <result column="line_id" property="lineId"/>
        <result column="mc_task_id" property="mcTaskId"/>
        <result column="item_id" property="itemId"/>
        <result column="source_line_no" property="sourceLineNo"/>
        <result column="mc_qty" property="mcQty"/>
        <result column="crt_time" property="crtTime"/>
        <result column="crt_user" property="crtUser"/>
        <result column="crt_host" property="crtHost"/>
        <result column="upd_time" property="updTime"/>
        <result column="upd_user" property="updUser"/>
        <result column="upd_host" property="updHost"/>
        <result column="rmk02" property="rmk02"/>
        <result column="rmk03" property="rmk03"/>
        <result column="rmk04" property="rmk04"/>
        <result column="rmk05" property="rmk05"/>
    </resultMap>

    <resultMap id="WipMcTaskLineView" type="com.cvte.scm.wip.domain.core.ckd.dto.view.WipMcTaskLineView">
        <result column="line_id" property="lineId"/>
        <result column="mc_task_id" property="mcTaskId"/>
        <result column="item_id" property="itemId"/>
        <result column="item_code" property="itemCode"/>
        <result column="source_line_no" property="sourceLineNo"/>
        <result column="source_line_id" property="sourceLineId"/>
        <result column="mc_qty" property="mcQty"/>
        <result column="delivery_out_no" property="deliveryOutNo"/>
        <result column="delivery_out_line_no" property="deliveryOutLineNo"/>
        <result column="delivery_out_status" property="deliveryOutStatus"/>
        <result column="delivery_out_qty" property="deliveryOutQty"/>
        <result column="delivery_out_post_qty" property="deliveryOutPostQty"/>
        <result column="delivery_in_no" property="deliveryInNo"/>
        <result column="delivery_in_line_no" property="deliveryInLineNo"/>
        <result column="delivery_in_status" property="deliveryInStatus"/>
        <result column="delivery_in_qty" property="deliveryInQty"/>
        <result column="delivery_in_post_qty" property="deliveryInPostQty"/>
        <result column="factory_code" property="factoryCode"/>
        <result column="factory_id" property="factoryId"/>
        <result column="factory_name" property="factoryName"/>
        <result column="out_stock_line_id" property="outStockLineId"/>
        <result column="in_stock_line_id" property="inStockLineId"/>
        <result column="crt_time" property="crtTime" />
        <result column="crt_user" property="crtUser" />
        <result column="crt_host" property="crtHost" />
        <result column="upd_time" property="updTime" />
        <result column="upd_user" property="updUser" />
        <result column="upd_host" property="updHost" />
        <result column="line_status" property="lineStatus" />
    </resultMap>


    <select id="listWipMcTaskLineView" resultMap="WipMcTaskLineView">
        select Wmtl.line_id
        , Wmtl.mc_task_id
        , Wmtl.item_id
        , Wmtl.source_line_no
        , Wmtl.source_line_id
        , Wmtl.mc_qty
        , Out_wmis.header_no delivery_out_no
        , Out_wmisl.inout_stock_line_id out_stock_line_id
        , Out_wmisl.line_no delivery_out_line_no
        , Out_wmisl.status delivery_out_status
        , Out_wmisl.qty delivery_out_qty
        , Out_wmisl.post_qty delivery_out_post_qty
        , In_wmis.header_no delivery_in_no
        , In_wmisl.inout_stock_line_id in_stock_line_id
        , In_wmisl.line_no delivery_in_line_no
        , In_wmisl.status delivery_in_status
        , In_wmisl.qty delivery_in_qty
        , In_wmisl.post_qty delivery_in_post_qty
        , Mi.item_code
        , Sofv.factory_code
        , sofv.factory_id
        , Sofv.factory_name
        , Wmtl.crt_time
        , Wmtl.crt_user
        , Wmtl.upd_time
        , Wmtl.upd_user
        , Wmtl.crt_host
        , Wmtl.upd_host
        , Wmtl.line_status
        from wip_mc_task_line Wmtl
        join wip_mc_task Wmt on Wmt.mc_task_id = Wmtl.mc_task_id
        join scm.md_item Mi on Mi.inventory_item_id = Wmtl.item_id
        left join scm.sys_org_factory_v Sofv on Sofv.ebs_factory_id = Wmt.factory_id
        left join wip_mc_inout_stock In_wmis on In_wmis.inout_stock_id = wmt.in_stock_id
        left join wip_mc_inout_stock_line In_wmisl on Wmtl.line_id = In_wmisl.mc_task_line_id and In_wmisl.inout_stock_id = Wmt.in_stock_id
        left join wip_mc_inout_stock_line Out_wmisl on Wmtl.line_id = Out_wmisl.mc_task_line_id and Out_wmisl.inout_stock_id = Wmt.out_stock_id
        left join wip_mc_inout_stock Out_wmis on Out_wmis.inout_stock_id = wmt.out_stock_id
        where 1=1
        <if test="lineStatus != null and lineStatus != ''">
            AND Wmtl.line_status = #{lineStatus}
        </if>
        <if test="taskIds != null and taskIds.size() > 0">
            AND Wmtl.mc_task_id in
            <foreach collection="taskIds" item="item" index="index" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        <if test="sourceLineIds != null and sourceLineIds.size() > 0">
            AND Wmtl.source_line_id in
            <foreach collection="sourceLineIds" item="item" index="index" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>

    </select>
</mapper>
